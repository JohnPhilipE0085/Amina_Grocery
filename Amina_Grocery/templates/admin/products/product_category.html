{% extends 'admin/admin_base.html' %}
{% load static %}

{% block title %}Admin Dashboard{% endblock %}

{% block extrahead %}
{% endblock %}

{% block content %}
<!-- Message Sidebar -->
<div id="messageSidebar" class="message-sidebar">
    {% for message in messages %}
    <div class="message {{ message.tags }}">{{ message }}</div>
    {% endfor %}
</div>

<div class="container mt-4">
    <h2 class="text-center mb-4">Product Categories</h2>
    <div class="row">
        {% for category in category %}
        <div class="col-md-4">
            <div class="card category-card shadow-sm">
                <div class="card-body text-center">
                    <h5 class="card-title">{{ category.name }}</h5>
                    {% if category.is_active %}
                    <a href="{% url 'delete_category' category=category %}" class="btn btn-danger">Delete</a>
                    {% else %}
                    <a href="{% url 'activate_category' category=category %}" class="btn btn-success">Activate</a>
                    {% endif %}
                    &nbsp;&nbsp;&nbsp;
                    <a href="#" class="btn btn-warning openModalBtn" data-id="{{ category.id }}"
                        data-name="{{ category.name }}">
                        Edit
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <form action="{% url 'product_category' %}" method="POST" class="category-form mt-5">
        {% csrf_token %}
        <label for="category" class="form-label">Category Name</label>
        <input type="text" name="category" id="category" class="form-control custom-input"
            placeholder="Enter category name" required>
        <button type="submit" class="btn btn-primary custom-btn mt-2">Create Category</button>
    </form>
</div>

<!-- Edit Category Modal -->
<div id="popupModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <form method="POST" action="{% url 'edit_category' %}">
            {% csrf_token %}
            <input type="hidden" name="id" id="categoryId">
            <label>Category Name:</label>
            <input type="text" name="name" id="categoryName" class="form-control" required>
            <br>
            <button type="submit" class="btn btn-primary">Update</button>
        </form>
    </div>
</div>

<!-- JS Script -->
<script>
    const modal = document.getElementById('popupModal');
    const openBtns = document.querySelectorAll('.openModalBtn');

    openBtns.forEach(btn => {
        btn.addEventListener('click', function (event) {
            event.preventDefault();
            const categoryId = this.getAttribute('data-id');
            const categoryName = this.getAttribute('data-name');

            document.getElementById('categoryId').value = categoryId;
            document.getElementById('categoryName').value = categoryName;

            modal.style.display = 'block';
        });
    });

    function closeModal() {
        modal.style.display = 'none';
    }

    window.onclick = function (event) {
        if (event.target === modal) {
            closeModal();
        }
    };
</script>

<!-- Modal CSS -->
<style>
    .modal {
        display: none;
        position: fixed;
        z-index: 100;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
        background-color: white;
        margin: 10% auto;
        padding: 20px;
        width: 40%;
        border-radius: 10px;
        position: relative;
    }

    .close {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 20px;
        cursor: pointer;
    }

    .custom-input {
        padding: 10px;
        margin-bottom: 10px;
        border: 2px solid #ced4da;
        border-radius: 5px;
        font-size: 16px;
    }

    .custom-btn {
        width: 100%;
        padding: 10px;
        font-weight: bold;
    }
</style>

<!-- Create Button Style -->
<style>
    .category-form {
        max-width: 400px;
        margin: auto;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
        text-align: center;
    }

    .form-label {
        font-weight: bold;
        display: block;
        margin-bottom: 8px;
    }
</style>

<!-- Messages -->
<style>
    .message-sidebar {
        position: fixed;
        right: 20px;
        top: 20px;
        width: auto;
        max-width: 250px;
        background: rgba(255, 255, 255, 0.9);
        color: #333;
        padding: 10px 15px;
        border-radius: 8px;
        box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease-in-out;
        z-index: 9999;
    }

    .message-sidebar.show {
        right: 20px;
    }

    .message {
        margin-bottom: 5px;
        padding: 8px 12px;
        border-radius: 5px;
        font-size: 14px;
        font-weight: 500;
    }

    .message.success {
        background-color: #d4edda;
        color: #155724;
        border-left: 4px solid #28a745;
    }

    .message.error {
        background-color: #f8d7da;
        color: #721c24;
        border-left: 4px solid #dc3545;
    }

    .message.warning {
        background-color: #fff3cd;
        color: #856404;
        border-left: 4px solid #ffc107;
    }

    .message.info {
        background-color: #d1ecf1;
        color: #0c5460;
        border-left: 4px solid #17a2b8;
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        let messageSidebar = document.getElementById("messageSidebar");

        if (messageSidebar.children.length > 0) {
            messageSidebar.classList.add("show");

            setTimeout(() => {
                messageSidebar.classList.remove("show");
            }, 4000);
        }
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
