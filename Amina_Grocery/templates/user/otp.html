<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTP Input</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>
        function validateOTP() {
            let otp = document.getElementById("otp").value;
            let submitBtn = document.getElementById("submitBtn");

            // Check if OTP is exactly 6 digits
            if (/^\d{6}$/.test(otp)) {
                submitBtn.disabled = false;
            } else {
                submitBtn.disabled = true;
            }
        }
    </script>


</head>

<body class="d-flex justify-content-center align-items-center vh-100 bg-light">

    {% if command == "forget password" %}
    <div class="card p-4 shadow-lg" style="width: 22rem;">
        <h4 class="text-center mb-3">Enter OTP</h4>
        <form method="POST" action="{% url 'forget_otp' %}">
            {% csrf_token %}
            <div class="mb-3">
                <label for="otp" class="form-label">6-Digit OTP</label>
                <input type="text" id="otp" name="otp" class="form-control text-center" maxlength="6" pattern="\d{6}"
                    placeholder="Enter OTP" oninput="validateOTP()" required>
            </div>
            <button type="submit" id="submitBtn" class="btn btn-primary w-100" disabled>Verify OTP</button>
        </form>
        <p>OTP expires in <span id="timer">5:00</span> minutes</p>
        <br>
        <a href="{% url 'forget_resend_otp' %}">Resend OTP</a>

        {% if messages %}
        {% for message in messages %}
        <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} alert-dismissible fade show"
            role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
        {% endif %}

    </div>
    {% endif %}

    {% if command == "create account" %}
    <div class="card p-4 shadow-lg" style="width: 22rem;">
        <h4 class="text-center mb-3">Enter OTP</h4>
        <form method="POST" action="{% url 'create_otp' %}">
            {% csrf_token %}
            <div class="mb-3">
                <label for="otp" class="form-label">6-Digit OTP</label>
                <input type="text" id="otp" name="otp" class="form-control text-center" maxlength="6" pattern="\d{6}"
                    placeholder="Enter OTP" oninput="validateOTP()" required>
            </div>
            <button type="submit" id="submitBtn" class="btn btn-primary w-100" disabled>Verify OTP</button>
        </form>
        <p>OTP expires in <span id="timer">5:00</span> minutes</p>
        <br>
        <a href="{% url 'resend_otp' %}">Resend OTP</a>

        <br>
        {% if messages %}
        {% for message in messages %}
        <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} alert-dismissible fade show"
            role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
        {% endif %}

    </div>
    {% endif %}

    {% if command == "edit_account_otp" %}
    <div class="card p-4 shadow-lg" style="width: 22rem;">
        <h4 class="text-center mb-3">Enter OTP</h4>
        <form method="POST" action="{% url 'edit_account_otp' %}">
            {% csrf_token %}
            <div class="mb-3">
                <label for="otp" class="form-label">6-Digit OTP</label>
                <input type="text" id="otp" name="otp" class="form-control text-center" maxlength="6" pattern="\d{6}"
                    placeholder="Enter OTP" oninput="validateOTP()" required>
            </div>
            <button type="submit" id="submitBtn" class="btn btn-primary w-100" disabled>Verify OTP</button>
        </form>
        <p>OTP expires in <span id="timer">5:00</span> minutes</p>
        <br>
        <a href="{% url 'edit_account_otp' %}">Resend OTP</a>

        {% if messages %}
        {% for message in messages %}
        <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} alert-dismissible fade show"
            role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
        {% endif %}

    </div>
    {% endif %}


    <script>
        let timeLeft = 300; // 5 minutes (300 seconds)
        let timerDisplay = document.getElementById("timer");

        function startTimer() {
            let timer = setInterval(() => {
                let minutes = Math.floor(timeLeft / 60);
                let seconds = timeLeft % 60;
                seconds = seconds < 10 ? "0" + seconds : seconds;

                timerDisplay.textContent = minutes + ":" + seconds;

                if (timeLeft > 0) {
                    timeLeft--;
                } else {
                    clearInterval(timer);
                    timerDisplay.textContent = "OTP Expired";
                    alert("Your OTP has expired. Please request a new one.");
                }
            }, 1000);
        }

        startTimer();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>